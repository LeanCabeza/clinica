<div class="container">
  <div class="row">
    <div class="col-md-4">
      <div class="menu-option-card" (click)="showReservarTurno = true; showProximosTurnos = false;showHistorialClinico = false; cargarHorarios(this.dniDoctorSeleccionado,this.fechaSeleccionada)">
        <div class="menu-option-content">
          <i class="fas fa-calendar-plus"></i>
          <h4>Reservar Turno</h4>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="menu-option-card" (click)="showProximosTurnos = true; showReservarTurno = false;showHistorialClinico=false; cargarProximosTurnos()">
        <div class="menu-option-content">
          <i class="fa-solid fa-business-time"></i>
          <h4>Proximos Turnos</h4>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="menu-option-card" (click)="showProximosTurnos=false;showHistorialClinico = true; showReservarTurno = false; cargarHistorialClinico()">
        <div class="menu-option-content">
          <i class="fas fa-file-medical-alt"></i>
          <h4>Historial Clínico</h4>
        </div>
      </div>
    </div>
  </div>

  <div class="content">
    <div class="reservar-turno" *ngIf="showReservarTurno">
      <div class="form-container">
        <h2>Reservar Turno</h2>
        <div class="form-group">
          <label for="especialidad">Selecciona una especialidad:</label>
          <select class="form-control" [(ngModel)]="especialidadSeleccionada" (change)="cargarDoctores()">
            <option *ngFor="let especialidad of especialidades" [value]="especialidad">{{ especialidad }}</option>
          </select>
        </div>
        <div class="form-group" *ngIf="doctores.length > 0">
          <label for="doctor">Selecciona un doctor:</label>
          <select class="form-control" [(ngModel)]="dniDoctorSeleccionado">
            <option *ngFor="let doctor of doctores" [value]="doctor.dni">{{ doctor.nombre }} {{ doctor.apellido }}</option>
          </select>
        </div>
        <div class="form-group" *ngIf="dniDoctorSeleccionado">
          <label for="fecha">Selecciona una Fecha:</label>
          <select class="form-control" [(ngModel)]="fechaSeleccionada" (change)="cargarHorarios(this.dniDoctorSeleccionado,this.fechaSeleccionada)">
            <option *ngFor="let fecha of fechas" [value]="fecha">{{ fecha }}</option>
          </select>
        </div>
        <div *ngIf="fechaSeleccionada">
          <h3>Horarios Disponibles</h3>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Hora</th>
                <th>Acción</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let horario of arrayHorarios">
                <td>{{ horario.horario }}</td>
                <td>
                  <button class="btn"
                          [class.btn-success]="horario.estado === 'disponible'"
                          [class.btn-danger]="horario.estado === 'ocupado'"
                          [disabled]="horario.estado === 'ocupado'"
                          (click)="reservarTurno(horario.horario)">
                    {{ horario.estado === 'ocupado' ? 'Reservado' : 'Reservar' }}
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="proximos-turnos" *ngIf="showProximosTurnos">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Especialidad</th>
            <th>Doctor</th>
            <th>Estado</th>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let turno of proximosTurnos">
            <td>{{ turno.especialidad }}</td>
            <td>{{ turno.nombreDoctor }} {{ turno.apellidoDoctor }} </td>
            <td>{{ turno.atendido ? 'Atendido ✅' : 'Pendiente de atencion ⌛' }}</td>
            <td>{{ turno.fecha }}</td>
            <td>{{ turno.hora }}</td>
            <td>
              <button class="btn btn-danger" (click)="cancelarTurno(turno)">Cancelar Turno</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="historial-clinico" *ngIf="showHistorialClinico">

    <div class="row">
      <div class="col-md-6">
        <div class="form-group">
          <label for="especialidadFiltro">Buscar por especialidad:</label>
          <input class="form-control" type="text" [(ngModel)]="especialidadFiltro" (input)="cargarHistorialClinico()">
        </div>
      </div>
      <div class="col-md-6">
        <div class="form-group">
          <label for="nombreApellidoFiltro">Buscar por nombre y apellido del doctor:</label>
          <input class="form-control" type="text" [(ngModel)]="nombreApellidoFiltro" (input)="cargarHistorialClinico()">
        </div>
      </div>
    </div>

      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Especialidad</th>
            <th>Doctor</th>
            <th>Estado</th>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let turno of historialClinico">
            <td>{{ turno.especialidad }}</td>
            <td>{{ turno.nombreDoctor }} {{ turno.apellidoDoctor }} </td>
            <td>{{ turno.atendido ? 'Atendido ✅' : 'Pendiente de atencion ⌛' }}</td>
            <td>{{ turno.fecha }}</td>
            <td>{{ turno.hora }}</td>
            <td>
              <button class="btn btn-primary" *ngIf="turno.resenia != null" (click)="verDetalle(turno)">Ver Reseña</button>
              <button class="btn btn-primary ms-2" (click)="verDetalle(turno)">Completar Encuesta</button>
              <button class="btn btn-success ms-2" (click)="calificarAtencion(turno)">Calificar Atencion</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
